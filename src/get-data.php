<?php    use DiDom\Document;    use Lib\MyLib;    set_time_limit(0);    require __DIR__ . '/../vendor/autoload.php';    do {        MyLib::println('** Choose the website to scan **');        MyLib::println('---------------- Menu select category ----------------');        MyLib::println('1 - Đặc sản ');        MyLib::println('2 - Shop');        MyLib::println('3 - Thời trang ');        MyLib::println('4 - Mua sắm ');        MyLib::println('Choose :');        $selected_website = fgets(fopen('php://stdin', 'r'));        MyLib::println('** Enter the total number of pages to be scanned (enter -1 for all pages) **');        $total_number_pages = fgets(fopen('php://stdin', 'r'));        if ($total_number_pages < -1 || $selected_website < 0 || $selected_website > 4) {            MyLib::println('Enter the wrong format !!!');        }        if ($total_number_pages == -1 ){               $total_number_pages = 999999999999;        }    } while ($total_number_pages < -1 || $selected_website < 0 || $selected_website > 4);    switch ($selected_website) {        case 1:            $url = 'https://toplist.vn/?a=POST&post=SE&q=%C4%91%E1%BA%B7c%20s%E1%BA%A3n&s=2&p=';            for ($i = 1; $i <= $total_number_pages; $i++) {                crawlData($i, $url, $fileName = "dacsan",$elms); // crawlData                if ($elms == null){                    return 0;                }            }            break;        case 2:            $url = 'https://toplist.vn/?a=POST&post=SE&q=shop&s=2&p=';            for ($i = 1; $i <= $total_number_pages; $i++) {                crawlData($i, $url, $fileName = "shop",$elms);                if ($elms == null){                    return 0;                }            }            break;        case 3:            $url = 'https://toplist.vn/?a=POST&post=SE&q=th%E1%BB%9Di%20trang&s=2&p=';            for ($i = 1; $i <= $total_number_pages; $i++) {                crawlData($i, $url, $fileName = "thoitrang",$elms);                if ($elms == null){                    return 0;                }            }            break;        case 4:            $url = 'https://toplist.vn/?a=POST&post=SE&q=mua%20s%E1%BA%AFm&s=2&p=';            for ($i = 1; $i <= $total_number_pages; $i++) {                crawlData($i, $url, $fileName = "muasam",$elms);                if ($elms == null){                    return 0;                }            }            break;        default:            MyLib::println('Enter the wrong format !');    }    // run    function crawlData($page, $url, $fileName,&$elms)    {        $url = $url . $page;        $baseURL = 'https://toplist.vn/';        if (MyLib::get_data($url, $content)) {            $dom = new Document();            $dom->load($content);            $result = [];            $elms = $dom->find('div[class=media-body]');            foreach ($elms as $elm) {                $url_a = $elm->find('h4[class=media-heading] a')[0];                $root = $baseURL . $url_a->getAttribute('href');                //get data page detail                if (MyLib::get_data($root, $content)) {                    $dom = new Document();                    $dom->load($content);                    $elms = $dom->find('div[class=media-body]');                    get_dateTime($dom, $dateTime);                    foreach ($elms as $key => $value) {                        get_nameShop($value, $shopName);                        get_content($type = 'address', $value, $address);                        get_content($type = 'fanpage', $value, $fanpage);                        get_content($type = 'phone', $value, $phone);                        get_content($type = 'website', $value, $website);                        if (!$address) {                            continue;                        }                        $result[] = [                            'dateTime' => $dateTime,                            'ShopName' => $shopName,                            'address' => $address,                            'fanpage' => $fanpage,                            'phone' => $phone,                            'website' => $website,                            'url' => $root                        ];                    }                } else {                    MyLib::println('Cannot get data for this page');                }            }        } else {            MyLib::println('Cannot get data for this page');        }        echo '<pre>' . (json_encode($result, JSON_UNESCAPED_UNICODE | JSON_PRETTY_PRINT)) . '</pre>';        if (!empty($result)){            MyLib::export_csv($result, $fileName = '../output/' . $fileName . '_' . $page . '.csv');            MyLib::exporeExcel($result, $page, $fileName);        }    }    function get_dateTime($content, &$dateTime)    {        $dateTime = $content->find('div[class=text-muted]')[0]->child(2)->text();    }    function get_nameShop($content, &$shopName)    {        $nameEls = $content->find('h3[class=media-heading]');        $shopName = '';        if (count($nameEls) > 0) {            foreach ($nameEls as $nameEl) {                $shopName = $nameEl->text();            }        }    }    function get_content($type, $content, &$output)    {        $output = '';        $elmS = $content->find('ul li strong');        $elmB = $content->find('ul li b');        $elmP = $content->find('p strong');        if (count($elmS) > 0 || count($elmB) > 0 || count($elmP)) {            $elment = '';            if (count($elmS) > 0) {                $elment = $elmS;            } else if (count($elmB) > 0) {                $elment = $elmB;            } else if (count($elmP) > 0) {                $elment = $elmP;            } else {                echo "does not exist ! ";            }            foreach ($elment as $elm) {                $lable = $elm->text();                if ($type == 'address') {                    $stringToSearch = 'Địa chỉ';                    if (count($elm->parent()->parent()->find('ul ul'))) {                        foreach ($elm->parent()->parent()->find('ul ul') as $u) {                            if (!$u) {                                continue;                            }                            $output .= $u->text();                        }                    }                    $pos = strpos($lable, $stringToSearch);                    if ($pos === false) {                    } else {                        if ($elm->parent()->has('ul')) {                            foreach ($elm->parent()->find('li') as $i) {                                $output .= $i->text() . "+";                            }                        }                        $output = $elm->parent()->text();                    }                } else if ($type == 'fanpage') {                    $stringToSearch = ["Facebook", "Fanpage"];                    foreach ($stringToSearch as $st) {                        $pos = strpos($lable, $st);                        if ($pos === false) {                        } else {                            if ($elm->parent()->has('ul') || $elm->parent()->parent()->has('ul')) {                                foreach ($elm->parent()->find('li') as $i) {                                    $output .= $i->text() . "+";                                }                            }                            $output = $elm->parent()->text();                        }                    }                } else if ($type == 'phone') {                    $stringToSearch = ["Hotline", "Điện thoại", "Số điện thoại liên lạc", "ĐT", "Hot line", "Số điện thoại", "SĐT"];                    foreach ($stringToSearch as $st) {                        $pos = strpos($lable, $st);                        if ($pos === false) {                        } else {                            if ($elm->parent()->has('ul') || $elm->parent()->parent()->has('ul')) {                                foreach ($elm->parent()->find('li') as $i) {                                    $output .= $i->text() . "+";                                }                            }                            $output = $elm->parent()->text();                        }                    }                } else if ($type == 'website') {                    $stringToSearch = 'Website';                    $pos = strpos($lable, $stringToSearch);                    if ($pos === false) {                    } else {                        if ($elm->parent()->has('ul') || $elm->parent()->parent()->has('ul')) {                            foreach ($elm->parent()->find('li') as $i) {                                $output .= $i->text() . "+";                            }                        }                        $output = $elm->parent()->text();                    }                }            }        }    }?>